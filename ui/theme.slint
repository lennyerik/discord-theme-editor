import { VerticalBox, ScrollView} from "std-widgets.slint";
import { ScrollView } from "std-widgets.slint";
import { CSSProperty } from "css-property.slint";

@rust-attr(derive(serde::Serialize, serde::Deserialize))
export struct CSSThemeProperty {
    colour-h: float,
    colour-s: float,
    colour-v: float,
    custom-css-active: bool,
    custom-css-value: string,
}

@rust-attr(derive(serde::Serialize, serde::Deserialize))
export struct Theme {
    background-primary: CSSThemeProperty,
    background-secondary: CSSThemeProperty,
    background-secondary-alt: CSSThemeProperty,
    background-tertiary: CSSThemeProperty,
    text-normal: CSSThemeProperty,
    text-muted: CSSThemeProperty,
    text-hyperlink: CSSThemeProperty,
    header-primary: CSSThemeProperty,
    header-secondary: CSSThemeProperty,
    channels-default: CSSThemeProperty,
}

export component ThemeControls inherits ScrollView {
    // Respect the content's min width and account for the scrollbar
    min-width: content.min-width + 30px;

    // TODO: I don't think there is a better way to do this in slint as of yet

    out property <Theme> theme: {
        background-primary: {
            colour-h: background-primary.colour-h,
            colour-s: background-primary.colour-s,
            colour-v: background-primary.colour-v,
            custom-css-active: background-primary.custom-css-active,
            custom-css-value: background-primary.custom-css-value,
        },
        background-secondary: {
            colour-h: background-secondary.colour-h,
            colour-s: background-secondary.colour-s,
            colour-v: background-secondary.colour-v,
            custom-css-active: background-secondary.custom-css-active,
            custom-css-value: background-secondary.custom-css-value,
        },
        background-secondary-alt: {
            colour-h: background-secondary-alt.colour-h,
            colour-s: background-secondary-alt.colour-s,
            colour-v: background-secondary-alt.colour-v,
            custom-css-active: background-secondary-alt.custom-css-active,
            custom-css-value: background-secondary-alt.custom-css-value,
        },
        background-tertiary: {
            colour-h: background-tertiary.colour-h,
            colour-s: background-tertiary.colour-s,
            colour-v: background-tertiary.colour-v,
            custom-css-active: background-tertiary.custom-css-active,
            custom-css-value: background-tertiary.custom-css-value,
        },
        text-normal: {
            colour-h: text-normal.colour-h,
            colour-s: text-normal.colour-s,
            colour-v: text-normal.colour-v,
            custom-css-active: text-normal.custom-css-active,
            custom-css-value: text-normal.custom-css-value,
        },
        text-muted: {
            colour-h: text-muted.colour-h,
            colour-s: text-muted.colour-s,
            colour-v: text-muted.colour-v,
            custom-css-active: text-muted.custom-css-active,
            custom-css-value: text-muted.custom-css-value,
        },
        text-hyperlink: {
            colour-h: text-hyperlink.colour-h,
            colour-s: text-hyperlink.colour-s,
            colour-v: text-hyperlink.colour-v,
            custom-css-active: text-hyperlink.custom-css-active,
            custom-css-value: text-hyperlink.custom-css-value,
        },
        header-primary: {
            colour-h: header-primary.colour-h,
            colour-s: header-primary.colour-s,
            colour-v: header-primary.colour-v,
            custom-css-active: header-primary.custom-css-active,
            custom-css-value: header-primary.custom-css-value,
        },
        header-secondary: {
            colour-h: header-secondary.colour-h,
            colour-s: header-secondary.colour-s,
            colour-v: header-secondary.colour-v,
            custom-css-active: header-secondary.custom-css-active,
            custom-css-value: header-secondary.custom-css-value,
        },
        channels-default: {
            colour-h: channels-default.colour-h,
            colour-s: channels-default.colour-s,
            colour-v: channels-default.colour-v,
            custom-css-active: channels-default.custom-css-active,
            custom-css-value: channels-default.custom-css-value,
        },
    };

    public function set-theme(theme: Theme) {
        background-primary.colour-h = theme.background-primary.colour-h;
        background-primary.colour-s = theme.background-primary.colour-s;
        background-primary.colour-v = theme.background-primary.colour-v;
        background-primary.custom-css-active = theme.background-primary.custom-css-active;
        background-primary.custom-css-value = theme.background-primary.custom-css-value;

        background-secondary.colour-h = theme.background-secondary.colour-h;
        background-secondary.colour-s = theme.background-secondary.colour-s;
        background-secondary.colour-v = theme.background-secondary.colour-v;
        background-secondary.custom-css-active = theme.background-secondary.custom-css-active;
        background-secondary.custom-css-value = theme.background-secondary.custom-css-value;

        background-secondary-alt.colour-h = theme.background-secondary-alt.colour-h;
        background-secondary-alt.colour-s = theme.background-secondary-alt.colour-s;
        background-secondary-alt.colour-v = theme.background-secondary-alt.colour-v;
        background-secondary-alt.custom-css-active = theme.background-secondary-alt.custom-css-active;
        background-secondary-alt.custom-css-value = theme.background-secondary-alt.custom-css-value;

        background-tertiary.colour-h = theme.background-tertiary.colour-h;
        background-tertiary.colour-s = theme.background-tertiary.colour-s;
        background-tertiary.colour-v = theme.background-tertiary.colour-v;
        background-tertiary.custom-css-active = theme.background-tertiary.custom-css-active;
        background-tertiary.custom-css-value = theme.background-tertiary.custom-css-value;

        text-normal.colour-h = theme.text-normal.colour-h;
        text-normal.colour-s = theme.text-normal.colour-s;
        text-normal.colour-v = theme.text-normal.colour-v;
        text-normal.custom-css-active = theme.text-normal.custom-css-active;
        text-normal.custom-css-value = theme.text-normal.custom-css-value;

        text-muted.colour-h = theme.text-muted.colour-h;
        text-muted.colour-s = theme.text-muted.colour-s;
        text-muted.colour-v = theme.text-muted.colour-v;
        text-muted.custom-css-active = theme.text-muted.custom-css-active;
        text-muted.custom-css-value = theme.text-muted.custom-css-value;

        text-hyperlink.colour-h = theme.text-hyperlink.colour-h;
        text-hyperlink.colour-s = theme.text-hyperlink.colour-s;
        text-hyperlink.colour-v = theme.text-hyperlink.colour-v;
        text-hyperlink.custom-css-active = theme.text-hyperlink.custom-css-active;
        text-hyperlink.custom-css-value = theme.text-hyperlink.custom-css-value;

        header-primary.colour-h = theme.header-primary.colour-h;
        header-primary.colour-s = theme.header-primary.colour-s;
        header-primary.colour-v = theme.header-primary.colour-v;
        header-primary.custom-css-active = theme.header-primary.custom-css-active;
        header-primary.custom-css-value = theme.header-primary.custom-css-value;

        header-secondary.colour-h = theme.header-secondary.colour-h;
        header-secondary.colour-s = theme.header-secondary.colour-s;
        header-secondary.colour-v = theme.header-secondary.colour-v;
        header-secondary.custom-css-active = theme.header-secondary.custom-css-active;
        header-secondary.custom-css-value = theme.header-secondary.custom-css-value;

        channels-default.colour-h = theme.channels-default.colour-h;
        channels-default.colour-s = theme.channels-default.colour-s;
        channels-default.colour-v = theme.channels-default.colour-v;
        channels-default.custom-css-active = theme.channels-default.custom-css-active;
        channels-default.custom-css-value = theme.channels-default.custom-css-value;
    }

    in property <length> window-height;

    callback changed();

    content := VerticalBox {
        max-width: 500px;

        alignment: start;
        background-primary := CSSProperty {
            name: "Background Primary";
            window-height: window-height;
            changed => { changed(); }
        }
        background-secondary := CSSProperty {
            name: "Background Secondary";
            window-height: window-height;
            changed => { changed(); }
        }
        background-secondary-alt := CSSProperty {
            name: "Background Secondary Alt";
            window-height: window-height;
            changed => { changed(); }
        }
        background-tertiary := CSSProperty {
            name: "Background Tertiary";
            window-height: window-height;
            changed => { changed(); }
        }
        text-normal := CSSProperty {
            name: "Text Normal";
            window-height: window-height;
            changed => { changed(); }
        }
        text-muted := CSSProperty {
            name: "Text Muted";
            window-height: window-height;
            changed => { changed(); }
        }
        text-hyperlink := CSSProperty {
            name: "Text Hyperlink";
            window-height: window-height;
            changed => { changed(); }
        }
        header-primary := CSSProperty {
            name: "Header Primary";
            window-height: window-height;
            changed => { changed(); }
        }
        header-secondary := CSSProperty {
            name: "Header Secondary";
            window-height: window-height;
            changed => { changed(); }
        }
        channels-default:= CSSProperty {
            name: "Channels Default";
            window-height: window-height;
            changed => { changed(); }
        }
    }
}
